<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Teste de Comunica√ß√£o IA (Flask)</title>
    <style>
        /* CSS M√çNIMO */
        body { font-family: sans-serif; margin: 20px; }
        #chat-box { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: scroll; margin-bottom: 10px; }
        .user { color: blue; }
        .ai { color: green; }
        .error { color: red; font-weight: bold; }
        .input-area { margin-top: 10px; }
    </style>
</head>
<body>

    <h2>Tester do Agente IA (Flask Backend)</h2>
    
    <div id="chat-box">
        <p class="ai">ü§ñ Servidor: **http://127.0.0.1:5000/api/chat**.</p>
        <p class="ai">ü§ñ Digite "Ol√°", "Servidor" ou "Python" para testar a comunica√ß√£o.</p>
    </div>
    
    <div class="input-area">
        <input type="text" id="user-input" placeholder="Digite aqui..." style="width: 80%;">
        <button onclick="sendMessage()">Enviar Teste</button>
    </div>

    <script>
        // L√ìGICA JAVASCRIPT PARA COMUNICAR COM O FLASK
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const API_URL = 'http://127.0.0.1:5000/api/chat'; // URL do endpoint Flask

        // Fun√ß√£o para adicionar a mensagem ao chat
        function appendMessage(sender, text) {
            const p = document.createElement('p');
            p.classList.add(sender);
            p.innerHTML = text; // Usamos innerHTML para permitir o negrito
            chatBox.appendChild(p);
            chatBox.scrollTop = chatBox.scrollHeight; // Rola para baixo
        }

        // Fun√ß√£o principal que envia a requisi√ß√£o para o Flask
        async function sendMessage() {
            const messageText = userInput.value.trim();
            if (messageText === "") return;

            // 1. Adiciona a mensagem do usu√°rio
            appendMessage('user', 'Voc√™: **' + messageText + '**');
            userInput.value = '';

            try {
                // Requisi√ß√£o ass√≠ncrona POST para o servidor Flask
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // Envia a mensagem do usu√°rio no corpo JSON
                    body: JSON.stringify({ message: messageText })
                });
                
                // Verifica se a resposta HTTP foi bem-sucedida
                if (!response.ok) {
                    throw new Error(`Erro de rede ou servidor: Status ${response.status}`);
                }

                const data = await response.json();
                
                // Exibe a resposta recebida do servidor Flask
                appendMessage('ai', 'IA (Flask): ' + data.response);

            } catch (error) {
                console.error('Erro de Comunica√ß√£o:', error);
                // Exibe uma mensagem de erro clara para o usu√°rio
                appendMessage('error', 'üö® Erro! Verifique se o **app.py** est√° rodando no terminal. Detalhe: ' + error.message);
            }
        }

        // Permite enviar a mensagem pressionando Enter
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>